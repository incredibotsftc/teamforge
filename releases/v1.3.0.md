# FTC TeamForge v1.3.0 - Notebook Drag-and-Drop Reordering

**Release Date:** 2025-01-22

## Overview

This release adds drag-and-drop reordering functionality to the notebook feature, allowing users to easily reorganize pages within and across folders. It also fixes existing data where all notebook pages had incorrect sort_order values.

## New Features

- **Drag-and-drop page reordering**: Drag notebook pages to reorder them within folders
- **Cross-folder drag-and-drop**: Drag pages from one folder and drop them at specific positions in another folder
- **Visual drop indicators**: Blue line indicators show exactly where a page will be placed when dropped
- **Optimistic UI updates**: Pages reorder instantly without page reload, with database updates happening in the background

## Improvements

- **Optimistic updates**: Notebook reordering now updates the UI immediately for a more responsive experience
- **Better folder structure updates**: Fixed issue where cross-folder page moves weren't properly reflected in the folder sidebar
- **Proper authentication**: API routes now correctly use Bearer token authentication

## Bug Fixes

- **Fixed sort_order initialization**: All existing notebook pages that had sort_order = 0 are now properly sequenced based on creation date
- **Fixed cross-folder drag-and-drop**: Pages can now be dragged directly to specific positions in other folders in a single operation
- **Fixed folder page arrays**: Folders now correctly show/hide pages when they're moved between folders

## Database Changes

- **Updated data**: All `notebook_pages` with sort_order = 0 are updated to sequential values (0, 1, 2, ...) grouped by folder
- **Updated data**: All `notebook_folders` with sort_order = 0 are updated to sequential values grouped by parent folder

## Migration Notes

### What's New in the Database

This migration fixes existing data by assigning proper sort_order values to all notebook pages and folders. Pages are ordered by their creation date (oldest first) within each folder.

### Manual Steps Required

None - the migration automatically fixes all existing data.

### Expected Behavior After Migration

- Each notebook page within a folder will have a unique sort_order starting from 0
- Pages will appear in the same visual order as before (by creation date)
- Users can now drag and drop to reorder pages as desired

## Verification

After running the migration, verify:
- [ ] Notebook pages have non-zero sort_order values
- [ ] Notebook folders have non-zero sort_order values
- [ ] Version 1.3.0 is recorded in schema_versions table
- [ ] You can drag and drop notebook pages to reorder them
- [ ] You can drag pages from one folder to another at specific positions

## Technical Details

### API Changes

- New endpoint: `POST /api/notebook/reorder` - Handles page reordering with proper position calculation
- Uses Bearer token authentication matching other API routes

### Frontend Changes

- Added `reorderPages` function to `useNotebook` hook with optimistic updates
- Updated `NotebookSidebar` with full drag-and-drop handlers
- Visual feedback with drop position indicators

---

**Migration Required:** Yes - Run migration script for v1.3.0

**Estimated Migration Time:** ~5-10 seconds (depends on number of notebook pages)

**Breaking Changes:** None
